---
title: 'API Reference'
description: 'Dokumentacja interfejsu programistycznego (API) systemu ATP dla integratorÃ³w i deweloperÃ³w'
category: 'API'
version: '1.0.0'
requiredRole: ['developer', 'admin']
icon: 'i-heroicons-code-bracket'
createdAt: '2025-04-12'
lastUpdated: '2025-05-28'
author: 'ATP System Team'
docType: 'reference'
status: 'published'
difficulty: 'advanced'
readingTime: 45
navigation:
  title: 'API Reference'
  icon: 'i-heroicons-code-bracket'
  order: 1
  group: 'Development'
seo:
  title: 'ATP System API Reference - Developer Documentation'
  description: 'Complete API reference for ATP System integration, authentication, and endpoints'
  keywords: ['API', 'REST', 'authentication', 'JWT', 'development', 'integration']
---

# Dokumentacja API

ATP System udostÄ™pnia interfejs programistyczny (API), ktÃ³ry pozwala na integracjÄ™ z zewnÄ™trznymi aplikacjami i usÅ‚ugami. Nasze API opiera siÄ™ na standardzie REST i wykorzystuje format JSON do wymiany danych.

## â„¹ï¸ Informacje ogÃ³lne

### Podstawowy URL

Wszystkie zapytania do API powinny byÄ‡ kierowane do nastÄ™pujÄ…cego adresu bazowego:

**Åšrodowisko deweloperskie:**
```
http://localhost:3000/api
```

**Åšrodowisko produkcyjne:**
```
https://twoja-domena.com/api
```

::alert{type="warning"}
Ta dokumentacja opisuje aktualnie dostÄ™pne endpointy w systemie ATP. System jest w fazie rozwoju - niektÃ³re funkcjonalnoÅ›ci mogÄ… byÄ‡ dodawane stopniowo.
::

### Uwierzytelnianie JWT

ATP System wykorzystuje zaawansowany system tokenÃ³w JWT (JSON Web Tokens) z automatycznym odnawianiem i wylogowaniem.

#### Rejestracja nowego uÅ¼ytkownika

```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "jan_kowalski",
    "email": "jan@example.com", 
    "password": "haslo123",
    "firstName": "Jan",
    "lastName": "Kowalski",
    "password_confirmation": "haslo123",
    "isAgreedToTerms": true
  }'
```

OdpowiedÅº:
```json
{
  "status": "success",
  "statusCode": 200,
  "payload": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "email": "jan@example.com",
      "username": "jan_kowalski",
      "firstName": "Jan",
      "lastName": "Kowalski",
      "roles": ["user"]
    },
    "expiresIn": 900
  }
}
```

#### Logowanie uÅ¼ytkownika

```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "jan@example.com",
    "password": "haslo123",
    "rememberMe": true
  }'
```

OdpowiedÅº zawiera access token i ustawia refresh token w HTTPOnly cookie:
```json
{
  "status": "success", 
  "payload": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 900
  }
}
```

#### Odnawianie access tokena

System automatycznie odnawia tokeny, ale moÅ¼esz teÅ¼ wywoÅ‚aÄ‡ endpoint rÄ™cznie:

```bash
curl -X POST http://localhost:3000/api/auth/refresh \
  -H "Cookie: refresh-token=your_refresh_token_here"
```

OdpowiedÅº:
```json
{
  "status": "success",
  "payload": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 900
  }
}
```

#### Autoryzacja API zapytaÅ„

DoÅ‚Ä…cz access token do kaÅ¼dego zapytania w nagÅ‚Ã³wku `Authorization`:

```bash
curl -X GET http://localhost:3000/api/profile \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

#### Automatyczne wylogowanie

System automatycznie wylogowuje uÅ¼ytkownika gdy:
- Refresh token wygaÅ›nie (po 30 dniach)
- Refresh token zostanie uniewaÅ¼niony
- WystÄ…piÄ… bÅ‚Ä™dy 401 z endpointu `/api/auth/refresh`

Proces automatycznego wylogowania:
1. âœ… Czyszczenie access tokena z session storage
2. âœ… Czyszczenie sesji uÅ¼ytkownika  
3. âœ… WyÅ›wietlenie powiadomienia "Session Expired"
4. âœ… Przekierowanie na stronÄ™ logowania

## ğŸ”— Endpointy API

Aktualnie dostÄ™pne endpointy w systemie ATP:

### Uwierzytelnianie

#### Rejestracja nowego uÅ¼ytkownika
```
POST /api/auth/register
```

#### Logowanie uÅ¼ytkownika
```
POST /api/auth/login
```

#### Odnawianie tokena dostÄ™pu
```
POST /api/auth/refresh
```

#### Wylogowanie uÅ¼ytkownika
```
POST /api/auth/logout
```

#### Test autoryzacji GitHub
```
GET /api/auth/github
```

### ZarzÄ…dzanie uÅ¼ytkownikami

#### Pobieranie listy uÅ¼ytkownikÃ³w
```
GET /api/users
```

#### Pobieranie szczegÃ³Å‚Ã³w uÅ¼ytkownika
```
GET /api/users/:id
```

#### Tworzenie nowego uÅ¼ytkownika
```
POST /api/users
```

### Profil uÅ¼ytkownika

#### Pobieranie profilu aktualnego uÅ¼ytkownika
```
GET /api/profile
```

#### Aktualizacja profilu uÅ¼ytkownika
```
PUT /api/profile
```

#### Zmiana hasÅ‚a
```
PUT /api/profile/password
```

### Sesje uÅ¼ytkownika

#### Pobieranie aktywnych sesji
```
GET /api/auth/sessions
```

#### Usuwanie konkretnej sesji
```
DELETE /api/auth/sessions/:id
```

#### UniewaÅ¼nianie wszystkich sesji
```
POST /api/auth/sessions/revoke
```

### Pliki i media

#### Upload plikÃ³w
```
POST /api/files
```

#### Pobieranie pliku multimedialnego
```
GET /api/media/[...pathname]
```

### Ustawienia systemu

#### Aktualizacja logo systemu
```
POST /api/settings/update/logo
```

### NarzÄ™dzia deweloperskie

#### Test poÅ‚Ä…czenia
```
GET /api/ping
```

#### Test autoryzacji JWT
```
GET /api/test-jwt
GET /api/auth/test-jwt
```

## ğŸ“‹ SzczegÃ³Å‚owe informacje o endpointach

### Uwierzytelnianie

Wszystkie endpointy uwierzytelniania uÅ¼ywajÄ… walidacji schematÃ³w z Zod i zwracajÄ… odpowiedzi w standardowym formacie JSON.

#### Struktura odpowiedzi rejestracji/logowania

```json
{
  "status": "success",
  "statusCode": 200,
  "payload": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "email": "jan@example.com",
      "username": "jan_kowalski",
      "firstName": "Jan",
      "lastName": "Kowalski",
      "roles": ["user"]
    },
    "expiresIn": 900
  }
}
```

### Zabezpieczenia

System wykorzystuje nastÄ™pujÄ…ce mechanizmy zabezpieczeÅ„:

- **JWT Tokens**: Access tokeny z czasem Å¼ycia 15 minut
- **Refresh Tokens**: HTTPOnly cookies z czasem Å¼ycia 30 dni  
- **Role-based Access Control**: Kontrola dostÄ™pu oparta na rolach
- **Session Management**: ZarzÄ…dzanie wieloma sesjami uÅ¼ytkownika
- **Device Tracking**: Åšledzenie urzÄ…dzeÅ„ dla bezpieczeÅ„stwa

### Formaty odpowiedzi

API zwraca dane w formacie JSON. KaÅ¼da odpowiedÅº zawiera:

**OdpowiedÅº pomyÅ›lna:**
```json
{
  "status": "success",
  "statusCode": 200,
  "payload": {
    // dane odpowiedzi
  }
}
```

**OdpowiedÅº z bÅ‚Ä™dem:**
```json
{
  "statusCode": 400,
  "statusMessage": "Bad Request",
  "message": "Detailed error message"
}
```

## âš ï¸ Kody bÅ‚Ä™dÃ³w

System zwraca standardowe kody statusu HTTP:

| Kod | Opis |
|-----|------|
| `200` | Operacja zakoÅ„czona sukcesem |
| `201` | ZasÃ³b zostaÅ‚ utworzony |
| `400` | NieprawidÅ‚owe dane wejÅ›ciowe |
| `401` | Brak autoryzacji |
| `403` | Brak uprawnieÅ„ |
| `404` | ZasÃ³b nie zostaÅ‚ znaleziony |
| `409` | Konflikt (np. uÅ¼ytkownik juÅ¼ istnieje) |
| `422` | BÅ‚Ä…d walidacji danych |
| `500` | WewnÄ™trzny bÅ‚Ä…d serwera |

## ğŸ›¡ï¸ Middleware i zabezpieczenia

System wykorzystuje nastÄ™pujÄ…ce middleware:

- **JWT Authentication**: Sprawdzanie tokenÃ³w dostÄ™pu
- **Permission Check**: Kontrola uprawnieÅ„ uÅ¼ytkownika  
- **Error Handler**: Centralizowane zarzÄ…dzanie bÅ‚Ä™dami
- **Request Validation**: Walidacja danych wejÅ›ciowych z uÅ¼yciem Zod

## ğŸ’» Åšrodowisko deweloperskie

### Testowanie API

DostÄ™pne narzÄ™dzia do testowania:

```bash
# Test poÅ‚Ä…czenia
curl http://localhost:3000/api/ping

# Test autoryzacji JWT
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:3000/api/test-jwt
```

### Konfiguracja deweloperska

System wymaga nastÄ™pujÄ…cej konfiguracji w `.env`:

```env
# Konfiguracja JWT
JWT_SECRET=your-jwt-secret
JWT_EXPIRES_IN=15m
REFRESH_TOKEN_EXPIRES_IN=30d

# Konfiguracja bazy danych  
DATABASE_URL=file:./database.db

# Opcjonalnie - OAuth
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
```

## ğŸ“– PrzykÅ‚ady uÅ¼ycia

### Rejestracja i logowanie

```javascript
// Rejestracja
const registerResponse = await fetch('/api/auth/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'jan_kowalski',
    email: 'jan@example.com',
    password: 'haslo123',
    password_confirmation: 'haslo123',
    firstName: 'Jan',
    lastName: 'Kowalski',
    isAgreedToTerms: true
  })
});

// Logowanie
const loginResponse = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'jan@example.com',
    password: 'haslo123',
    rememberMe: true
  })
});
```

### Autoryzowane zapytania

```javascript
const profileResponse = await fetch('/api/profile', {
  headers: {
    'Authorization': `Bearer ${accessToken}`
  }
});
```

## ğŸ—„ï¸ Struktura bazy danych

System wykorzystuje SQLite z nastÄ™pujÄ…cymi gÅ‚Ã³wnymi modelami:

### Users
- `id` - Unikalny identyfikator
- `username` - Nazwa uÅ¼ytkownika
- `email` - Adres e-mail (unikalny)
- `firstName`, `lastName` - ImiÄ™ i nazwisko
- `avatarUrl` - URL do awatara
- `bio` - BiografiÄ™ uÅ¼ytkownika
- `status` - Status konta (active/inactive)
- `isAgreedToTerms` - Zgoda na regulamin

### Roles & UserRoles
- System rÃ³l z powiÄ…zaniami many-to-many
- Kontrola dostÄ™pu oparta na rolach

### RefreshTokens
- ZarzÄ…dzanie tokenami odÅ›wieÅ¼ajÄ…cymi
- Åšledzenie sesji uÅ¼ytkownika

## ğŸ—ºï¸ Roadmap API

Planowane rozszerzenia systemu:

- ğŸ”„ **W trakcie**: ZarzÄ…dzanie sesjami uÅ¼ytkownika
- ğŸ“… **Planowane**: System uprawnieÅ„ i rÃ³l  
- ğŸ“… **Planowane**: API do zarzÄ…dzania zawodnikami
- ğŸ“… **Planowane**: API do planÃ³w treningowych
- ğŸ“… **Planowane**: System powiadomieÅ„
- ğŸ“… **Planowane**: Integracje zewnÄ™trzne

## ğŸ†˜ Wsparcie techniczne

W przypadku problemÃ³w z API:

1. SprawdÅº dokumentacjÄ™ endpointu
2. Zweryfikuj format danych wejÅ›ciowych
3. SprawdÅº kody bÅ‚Ä™dÃ³w HTTP
4. Skonsultuj siÄ™ z logami aplikacji

::alert{type="info"}
System ATP jest w aktywnym rozwoju. Ta dokumentacja jest regularnie aktualizowana zgodnie z nowymi funkcjonalnoÅ›ciami.
::
